(function(n){n(function(){function f(){var r={};return i.serializeArray().map(function(n){r[abp.utils.toCamelCase(n.name)]=n.value}),n.extend(r,t)}function e(){u.ajax.reload()}function s(n){try{var t=JSON.parse(n);return JSON.stringify(t,null,4)}catch(i){return n}}function h(t){n("#AuditLogDetailModal_UserName").html(t.userName);n("#AuditLogDetailModal_ClientIpAddress").html(t.clientIpAddress);n("#AuditLogDetailModal_ClientName").html(t.clientName);n("#AuditLogDetailModal_BrowserInfo").html(t.browserInfo);n("#AuditLogDetailModal_ServiceName").html(t.serviceName);n("#AuditLogDetailModal_MethodName").html(t.methodName);n("#AuditLogDetailModal_ExecutionTime").html(moment(t.executionTime).fromNow()+" ("+moment(t.executionTime).format("YYYY-MM-DD hh:mm:ss")+")");n("#AuditLogDetailModal_Duration").html(app.localize("Xms",t.executionDuration));n("#AuditLogDetailModal_Parameters").html(s(t.parameters));t.impersonatorUserId?n("#AuditLogDetailModal_ImpersonatorInfo").show():n("#AuditLogDetailModal_ImpersonatorInfo").hide();t.exception?(n("#AuditLogDetailModal_Success").hide(),n("#AuditLogDetailModal_Exception").show(),n("#AuditLogDetailModal_Exception").html(t.exception)):(n("#AuditLogDetailModal_Exception").hide(),n("#AuditLogDetailModal_Success").show());t.customData?(n("#AuditLogDetailModal_CustomData_None").hide(),n("#AuditLogDetailModal_CustomData").show(),n("#AuditLogDetailModal_CustomData").html(t.customData)):(n("#AuditLogDetailModal_CustomData").hide(),n("#AuditLogDetailModal_CustomData_None").show());n("#AuditLogDetailModal").modal("show")}var o=n("#AuditLogsTable"),i=n("#AuditLogFilterForm"),r=abp.services.app.auditLog,t={startDate:moment().startOf("day"),endDate:moment().endOf("day")},u;i.find("input.date-range-picker").daterangepicker(n.extend(!0,app.createDateRangePickerOptions(),t),function(n,i){t.startDate=n.format("YYYY-MM-DDT00:00:00Z");t.endDate=i.format("YYYY-MM-DDT23:59:59.999Z")});u=o.DataTable({paging:!0,serverSide:!0,processing:!0,listAction:{ajaxFunction:r.getAuditLogs,inputFilter:function(){return f()}},columnDefs:[{targets:0,data:null,orderable:!1,defaultContent:"",rowAction:{element:n("<div/>").addClass("text-center").append(n("<button/>").addClass("btn btn-default btn-xs").attr("title",app.localize("AuditLogDetail")).append(n("<i/>").addClass("fa fa-search"))).click(function(){h(n(this).data())})}},{targets:1,data:"exception",orderable:!1,render:function(t){var i=n("<div/>").addClass("text-center");return t?i.append(n("<i/>").addClass("fa fa-warning font-yellow-gold").attr("title",app.localize("HasError"))):i.append(n("<i/>").addClass("fa fa-check-circle font-green").attr("title",app.localize("Success"))),i[0].outerHTML}},{targets:2,data:"executionTime",render:function(n){return moment(n).format("YYYY-MM-DD HH:mm:ss")}},{targets:3,data:"userName"},{targets:4,data:"serviceName"},{targets:5,data:"methodName"},{targets:6,data:"executionDuration",render:function(n){return app.localize("Xms",n)}},{targets:7,data:"clientIpAddress",orderable:!1},{targets:8,data:"clientName"},{targets:9,data:"browserInfo",render:function(t){return n("<span/>").text(abp.utils.truncateStringWithPostfix(t,32)).attr("title",t)[0].outerHTML}}]});n("#RefreshAuditLogsButton").click(function(n){n.preventDefault();e()});n("#ExportAuditLogsToExcelButton").click(function(n){n.preventDefault();r.getAuditLogsToExcel(f()).done(function(n){app.downloadTempFile(n)})});n("#ShowAdvancedFiltersSpan").click(function(){n("#ShowAdvancedFiltersSpan").hide();n("#HideAdvancedFiltersSpan").show();n("#AdvacedAuditFiltersArea").slideDown()});n("#HideAdvancedFiltersSpan").click(function(){n("#HideAdvancedFiltersSpan").hide();n("#ShowAdvancedFiltersSpan").show();n("#AdvacedAuditFiltersArea").slideUp()});i.keydown(function(n){n.which===13&&(n.preventDefault(),e())})})})(jQuery);