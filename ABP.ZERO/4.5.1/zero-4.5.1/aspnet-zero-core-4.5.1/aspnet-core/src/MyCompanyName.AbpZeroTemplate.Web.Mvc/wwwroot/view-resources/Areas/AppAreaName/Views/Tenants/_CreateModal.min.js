(function(n){n.validator.addMethod("tenancyNameRegex",function(n,t,i){return i.test(n)},app.localize("TenantName_Regex_Description"));app.modals.CreateTenantModal=function(){var r=abp.services.app.tenant,t=null,u=new app.PasswordComplexityHelper,i;this.init=function(r){function p(){v.is(":checked")?(a.slideUp("fast"),y.removeAttr("required")):(a.slideDown("fast"),y.attr("required","required"))}var f,e,s,o,h,c,l;i=r;f=i.getModal();t=f.find("form[name=TenantInformationsForm]");t.validate({rules:{TenancyName:{tenancyNameRegex:new RegExp(t.find("input[name=TenancyName]").attr("regex"))}}});e=f.find("input[name=AdminPassword],input[name=AdminPasswordRepeat]");s=e.closest(".form-group");u.setPasswordComplexityRules(e,window.passwordComplexitySetting);n("#CreateTenant_SetRandomPassword").change(function(){n(this).is(":checked")?(s.slideUp("fast"),e.removeAttr("required")):(s.slideDown("fast"),e.attr("required","required"))});o=f.find("input[name=ConnectionString]");h=o.closest(".form-group");n("#CreateTenant_UseHostDb").change(function(){n(this).is(":checked")?(h.slideUp("fast"),o.removeAttr("required")):(h.slideDown("fast"),o.attr("required","required"))});f.find(".date-time-picker").datetimepicker({locale:abp.localization.currentLanguage.name,format:"L"});var a=f.find("input[name=SubscriptionEndDateUtc]").parent("div"),v=f.find("#CreateTenant_IsUnlimited"),y=f.find("input[name=SubscriptionEndDateUtc]");v.change(function(){p()});p();c=f.find("#EditionId");l=f.find("#CreateTenant_IsInTrialPeriod");c.change(function(){var t=n("option:selected",this).attr("data-isfree")==="True",i=n("option:selected",this).val();t?l.closest("div").slideUp("fast"):l.closest("div").slideDown("fast");i<=0?f.find(".subscription-component").slideUp("fast"):f.find(".subscription-component").slideDown("fast")});c.trigger("change")};this.save=function(){if(t.valid()){var u=t.serializeFormToObject();u.SubscriptionEndDateUtc=n("#CreateTenant_IsUnlimited").is(":visible")&&!n("#CreateTenant_IsUnlimited").is(":checked")?n(".date-time-picker").data("DateTimePicker").date().format("YYYY-MM-DDTHH:mm:ss")+"Z":null;u.SetRandomPassword&&(u.Password=null);u.UseHostDb&&(u.ConnectionString=null);i.setBusy(!0);r.createTenant(u).done(function(){abp.notify.info(app.localize("SavedSuccessfully"));i.close();abp.event.trigger("app.createTenantModalSaved")}).always(function(){i.setBusy(!1)})}}}})(jQuery);